# Create your views here.
from django.shortcuts import render_to_response, get_object_or_404, render
from django.template import RequestContext  
from django.http import HttpResponse  
from mytweetsrv.models import Item  
from django.utils import simplejson as json  
from django.contrib import auth
from django.http import HttpResponseRedirect
from django.contrib.auth.forms import UserCreationForm

def home(request):  
    return render_to_response('home.html', {},   
        context_instance=RequestContext(request))

def register(request):
    if request.method == 'POST':
        form = UserCreationForm(request.POST)
        if form.is_valid():
            new_user = form.save()
            'return HttpResponseRedirect("/login/")
            return render(request, "login.html")
    else:
        form = UserCreationForm()
    return render(request, "register.html", {
        'form': form,
})
    
def login(request):
    username = request.POST.get('username', '')
    password = request.POST.get('password', '')
    user = auth.authenticate(username=username, password=password)
    if user is not None and user.is_active:
        # Correct password, and the user is marked "active"
        auth.login(request, user)
        # Redirect to a success page.
        return HttpResponseRedirect("/login/")
    else:
        # Show an error page
        return HttpResponseRedirect("/invalid/")

def logout(request):
    auth.logout(request)
    # Redirect to a success page.
    return HttpResponseRedirect("/logout/")

def data(request):  
    mimetype = 'application/json'      
      
    udata = Item.objects.all()  
    sdata = []  
    for d in udata:  
        a = {'id': d.id, 'title': d.title }  
        sdata.append(a)  
    return HttpResponse(json.dumps(sdata), mimetype)


  