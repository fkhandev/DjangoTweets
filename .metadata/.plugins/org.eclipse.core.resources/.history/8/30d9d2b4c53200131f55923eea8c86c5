# Create your views here.
from django.shortcuts import render_to_response, get_object_or_404
from django.template import RequestContext  
from django.http import HttpResponse  
from mytweetsrv.models import Item  
from django.utils import simplejson as json  
from django.contrib import auth
from django.http import HttpResponseRedirect
from django.contrib.auth.forms import UserCreationForm

def home(request):  
    return render_to_response('home.html', {},   
        context_instance=RequestContext(request))

def register(request):
    if request.method == 'POST':
        form = UserCreationForm(request.POST)
        if form.is_valid():
            new_user = form.save()
            print "new user saved"
            if new_user is not None and new_user.is_active:
                print "logging in"
                login(request)
            else:
                
                return HttpResponseRedirect("/login/")
    else:
        print "request is get"
        form = UserCreationForm()

return render_to_response("register.html", {'form': form,},context_instance=RequestContext(request))
    
def login(request):
    username = request.POST.get('username', '')
    password = request.POST.get('password', '')
    user = auth.authenticate(username=username, password=password)
    
    if user is not None and user.is_active:
        # Correct password, and the user is marked "active"
        auth.login(request, user)
        # Redirect to a success page.
        print(" success")
        return render_to_response('welcome.html', {},   
        context_instance=RequestContext(request))
    else:
        # Show an error page
        print("error ")
        return render_to_response('login.html', {},   
        context_instance=RequestContext(request))

def logout(request):
    auth.logout(request)
    # Redirect to a success page.
    return HttpResponseRedirect("/logout/")

def data(request):  
    mimetype = 'application/json'      
      
    udata = Item.objects.all()  
    sdata = []  
    for d in udata:  
        a = {'id': d.id, 'title': d.title }  
        sdata.append(a)  
    return HttpResponse(json.dumps(sdata), mimetype)


  